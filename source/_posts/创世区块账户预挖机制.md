---
title: 创世区块账户预挖机制
author: Bill Zong
tags:
  - ethereum
  - source
  - mining
categories:
  - 区块链
abbrlink: 8d8620
date: 2021-04-12 22:23:00
---
# 背景

预挖是指在创世区块中，将部分账户余额状态修改为指定数值的操作。

# go-ethereum实现

公募阶段筹集了大量的账户，及对应的`BTC`。在主网上线时，需要对这些账户提供指定比例兑换的`Ether`。

`eth`采用了最简单也是最直接的做法，在创世区块中，将所有这些账户的信息都填入块内，并由此生成创世区块的Hash值及世界状态，并写入数据库中。预计是在前期，使用一定算力的矿机支持，使该创世区块完全被绝大部分网络承认，再也无法被其它**伪链** *（篡改的创世区块）*攻击。

# 重要伪代码流程

```go
//core/genesis.go

type GenesisAlloc map[common.Address]GenesisAccount // 预挖账户

type Genesis struct {
	Alloc GenesisAlloc // 调试时只需要修改这个配置即可
}

func SetupGenesisBlock() {
	genesis.Commit(db) { // 内部代码。db为链结构数据库
		block := g.ToBlock(db) { // 内部代码
			statedb := state.New(db) // 根据当前db，创建新的statedb，每个区块都会对应一个
			for addr, account := range g.Alloc {
				statedb.AddBalance(addr, account.Balance) // 写入预挖结果
			}
			root := statedb.IntermediateRoot() //生成全局状态树根
			head := &types.Header{ // 创世区块头
				Root: root,
			}
			statedb.Commit() // 写入潜在的内存数据库
			statedb.Database().TrieDB().Commit(root) // 使用trieDatabase写入树
		}
		
		// 写入区块的一系列流程，包括区块、收据等（预挖无收据）
		rawdb.WriteBlock(db, block)
		rawdb.WriteReceipts(db, receipts)
	}
}

```

# 迁移剩余问题

涉及到主网预挖，我们的操作可能会涉及到分配锁仓？是否仅为手动操作而不是代码支持？

另外，挖矿的奖励分配调整在代码层面如何实现？是使用代码？还是使用“超级管理员”接口的方式？