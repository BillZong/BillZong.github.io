<!DOCTYPE html><html lang="zh"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> CentOS7升级内核全流程 · 知易行难，一路向前</title><meta name="description" content="CentOS7升级内核全流程 - Bill Zong"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/favicon.ico?v=2021"><link rel="stylesheet" href="/css/style.css"><link rel="search" type="application/opensearchdescription+xml" href="https://billzong.github.io/atom.xml" title="知易行难，一路向前"><meta name="generator" content="Hexo 4.2.1"><link rel="alternate" href="/atom.xml" title="知易行难，一路向前" type="application/atom+xml">
<link rel="alternate" href="/rss2.xml" title="知易行难，一路向前" type="application/rss+xml">
</head><body><div class="wrap"><header><h1 class="title">知易行难，一路向前</h1><ul class="nav nav-list"><li class="nav-list-item"><a class="nav-list-link" href="/" target="_self">主页</a></li><li class="nav-list-item"><a class="nav-list-link" href="/archives/" target="_self">归档</a></li><li class="nav-list-item"><a class="nav-list-link" href="https://github.com/billzong" target="_blank">Github主页</a></li></ul></header><main class="container"><div class="post"><article class="post-block"><h1 class="post-title">CentOS7升级内核全流程</h1><div class="post-info">2021-04-25</div><div class="post-content"><p>rpm –import <a href="https://www.elrepo.org/RPM-GPG-KEY-elrepo.org" target="_blank" rel="noopener">https://www.elrepo.org/RPM-GPG-KEY-elrepo.org</a></p>
<h1 id="安装Redhat内核仓库"><a href="#安装Redhat内核仓库" class="headerlink" title="安装Redhat内核仓库"></a>安装Redhat内核仓库</h1><p>#rpm -Uvh <a href="http://www.elrepo.org/elrepo-release-7.0-3.el7.elrepo.noarch.rpm" target="_blank" rel="noopener">http://www.elrepo.org/elrepo-release-7.0-3.el7.elrepo.noarch.rpm</a></p>
<h1 id="或者如上指定版本，目前版本为7-0-5"><a href="#或者如上指定版本，目前版本为7-0-5" class="headerlink" title="或者如上指定版本，目前版本为7.0-5"></a>或者如上指定版本，目前版本为7.0-5</h1><h1 id="yum-install-https-www-elrepo-org-elrepo-release-7-0-3-el7-elrepo-noarch-rpm-y"><a href="#yum-install-https-www-elrepo-org-elrepo-release-7-0-3-el7-elrepo-noarch-rpm-y" class="headerlink" title="yum install https://www.elrepo.org/elrepo-release-7.0-3.el7.elrepo.noarch.rpm -y"></a>yum install <a href="https://www.elrepo.org/elrepo-release-7.0-3.el7.elrepo.noarch.rpm" target="_blank" rel="noopener">https://www.elrepo.org/elrepo-release-7.0-3.el7.elrepo.noarch.rpm</a> -y</h1><p>yum install <a href="https://www.elrepo.org/elrepo-release-7.el7.elrepo.noarch.rpm" target="_blank" rel="noopener">https://www.elrepo.org/elrepo-release-7.el7.elrepo.noarch.rpm</a> -y</p>
<h1 id="查看内核仓库元信息"><a href="#查看内核仓库元信息" class="headerlink" title="查看内核仓库元信息"></a>查看内核仓库元信息</h1><p>yum –disablerepo=* –enablerepo=elrepo-kernel repolist</p>
<h1 id="查看内容仓库所有版本"><a href="#查看内容仓库所有版本" class="headerlink" title="查看内容仓库所有版本"></a>查看内容仓库所有版本</h1><p>yum –disablerepo=* –enablerepo=elrepo-kernel list kernel*</p>
<h1 id="安装最新的-LT-版本"><a href="#安装最新的-LT-版本" class="headerlink" title="安装最新的 LT 版本"></a>安装最新的 LT 版本</h1><p>yum –disablerepo=* –enablerepo=elrepo-kernel install  kernel-lt.x86_64  -y</p>
<h1 id="也可以安装最新的主线分支版本"><a href="#也可以安装最新的主线分支版本" class="headerlink" title="也可以安装最新的主线分支版本"></a>也可以安装最新的主线分支版本</h1><h1 id="yum-–disablerepo-–enablerepo-elrepo-kernel-install-kernel-ml-x86-64-y"><a href="#yum-–disablerepo-–enablerepo-elrepo-kernel-install-kernel-ml-x86-64-y" class="headerlink" title="yum –disablerepo=* –enablerepo=elrepo-kernel install  kernel-ml.x86_64  -y"></a>yum –disablerepo=* –enablerepo=elrepo-kernel install  kernel-ml.x86_64  -y</h1><h1 id="删除旧版本工具包"><a href="#删除旧版本工具包" class="headerlink" title="删除旧版本工具包"></a>删除旧版本工具包</h1><p>yum remove kernel-tools-libs.x86_64 kernel-tools.x86_64  -y</p>
<h1 id="安装新版本工具包"><a href="#安装新版本工具包" class="headerlink" title="安装新版本工具包"></a>安装新版本工具包</h1><p>yum –disablerepo=* –enablerepo=elrepo-kernel install kernel-lt-tools.x86_64  -y</p>
<h1 id="查看内核插入顺序"><a href="#查看内核插入顺序" class="headerlink" title="查看内核插入顺序"></a>查看内核插入顺序</h1><p>awk -F &#39; ‘$1==”menuentry “ {print i++ “ : “ $2}’ /etc/grub2.cfg</p>
<h1 id="或者使用下面的命令查看"><a href="#或者使用下面的命令查看" class="headerlink" title="或者使用下面的命令查看"></a>或者使用下面的命令查看</h1><p>grep “^menuentry” /boot/grub2/grub.cfg | cut -d “‘“ -f2</p>
<h1 id="查看当前实际启动顺序"><a href="#查看当前实际启动顺序" class="headerlink" title="查看当前实际启动顺序"></a>查看当前实际启动顺序</h1><p>grub2-editenv list</p>
<h1 id="设置默认启动，记得修改版本为当前的版本"><a href="#设置默认启动，记得修改版本为当前的版本" class="headerlink" title="设置默认启动，记得修改版本为当前的版本"></a>设置默认启动，记得修改版本为当前的版本</h1><p>grep “^menuentry” /boot/grub2/grub.cfg | cut -d “‘“ -f2 | grep -v ‘tool’ | awk ‘NR==1{print}’ | while read kernal; do grub2-set-default “$kernal”; done</p>
<h1 id="目前版本信息也是一样的"><a href="#目前版本信息也是一样的" class="headerlink" title="目前版本信息也是一样的"></a>目前版本信息也是一样的</h1><h1 id="grub2-set-default-‘CentOS-Linux-5-10-9-1-el7-elrepo-x86-64-7-Core-’"><a href="#grub2-set-default-‘CentOS-Linux-5-10-9-1-el7-elrepo-x86-64-7-Core-’" class="headerlink" title="grub2-set-default ‘CentOS Linux (5.10.9-1.el7.elrepo.x86_64) 7 (Core)’"></a>grub2-set-default ‘CentOS Linux (5.10.9-1.el7.elrepo.x86_64) 7 (Core)’</h1><h1 id="或者直接设置默认启动内核系统下标"><a href="#或者直接设置默认启动内核系统下标" class="headerlink" title="或者直接设置默认启动内核系统下标"></a>或者直接设置默认启动内核系统下标</h1><h1 id="grub2-set-default-0-自测无效"><a href="#grub2-set-default-0-自测无效" class="headerlink" title="grub2-set-default 0 # 自测无效"></a>grub2-set-default 0 # 自测无效</h1><h1 id="重启并检查"><a href="#重启并检查" class="headerlink" title="重启并检查"></a>重启并检查</h1><p>reboot</p>
<h1 id="查看系统中全部的内核rpm包"><a href="#查看系统中全部的内核rpm包" class="headerlink" title="查看系统中全部的内核rpm包"></a>查看系统中全部的内核rpm包</h1><p>rpm -qa |grep kernel</p>
<h1 id="如果不考虑使用老内核，也可以将其清除掉"><a href="#如果不考虑使用老内核，也可以将其清除掉" class="headerlink" title="如果不考虑使用老内核，也可以将其清除掉"></a>如果不考虑使用老内核，也可以将其清除掉</h1><h1 id="删除旧内核的rpm包"><a href="#删除旧内核的rpm包" class="headerlink" title="删除旧内核的rpm包"></a>删除旧内核的rpm包</h1><p>yum remove kernel-3.10.0-957.el7.x86_64</p>
</div></article></div></main><footer><div class="paginator"><a class="prev" href="/post/c9a962b3.html">上一篇</a><a class="next" href="/post/87c46404.html">下一篇</a></div><div class="copyright"><p>© 2021 PEACE & LOVE</p><p>Powered by <a href="https://hexo.io/" target="_blank">Hexo</a>, <a href="https://github.com/jeremyfan/hexo-theme-still" target="_blank">theme</a> by <a href="https://github.com/jeremyfan" target="_blank">Bill Zong</a>.</p></div></footer></div></body></html>