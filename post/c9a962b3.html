<!DOCTYPE html><html lang="zh"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> CentOS部署和配置NTP服务器 · 知易行难，一路向前</title><meta name="description" content="CentOS部署和配置NTP服务器 - Bill Zong"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/favicon.ico?v=2021"><link rel="stylesheet" href="/css/style.css"><link rel="search" type="application/opensearchdescription+xml" href="https://billzong.github.io/atom.xml" title="知易行难，一路向前"><meta name="generator" content="Hexo 4.2.1"><link rel="alternate" href="/atom.xml" title="知易行难，一路向前" type="application/atom+xml">
<link rel="alternate" href="/rss2.xml" title="知易行难，一路向前" type="application/rss+xml">
</head><body><div class="wrap"><header><h1 class="title">知易行难，一路向前</h1><ul class="nav nav-list"><li class="nav-list-item"><a class="nav-list-link" href="/" target="_self">主页</a></li><li class="nav-list-item"><a class="nav-list-link" href="/archives/" target="_self">归档</a></li><li class="nav-list-item"><a class="nav-list-link" href="https://github.com/billzong" target="_blank">Github主页</a></li></ul></header><main class="container"><div class="post"><article class="post-block"><h1 class="post-title">CentOS部署和配置NTP服务器</h1><div class="post-info">2021-04-25</div><div class="post-content"><h2 id="ntp服务端"><a href="#ntp服务端" class="headerlink" title="ntp服务端"></a>ntp服务端</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># 将所有节点设置为中国时区</span><br><span class="line">echo &quot;Asia&#x2F;shanghai&quot; &gt; &#x2F;etc&#x2F;timezone</span><br><span class="line">ln -sf &#x2F;usr&#x2F;share&#x2F;zoneinfo&#x2F;Asia&#x2F;Shanghai &#x2F;etc&#x2F;localtime</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># 设置系统时间</span><br><span class="line">date -s &#39;2021-01-11 15:20:00&#39;</span><br><span class="line"># 写入硬件时间</span><br><span class="line">hwclock -w</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"># 安装chrony</span><br><span class="line">yum install chrony -y</span><br><span class="line"></span><br><span class="line"># 对于用作ntp server的服务器，需要修改server本身的时钟源:</span><br><span class="line">sed -e &#39;s!centos.pool.ntp.org!cn.pool.ntp.org!g&#39; -i &#x2F;etc&#x2F;chrony.conf</span><br><span class="line"># 也可以考虑不再同步外部NTP服务</span><br><span class="line">sed -i &#39;&#x2F;^server*&#x2F;d&#39; &#x2F;etc&#x2F;chrony.conf</span><br><span class="line"></span><br><span class="line"># 设置可以访问服务的IP网段</span><br><span class="line">sed -e &#39;&#x2F;^#allow*&#x2F;a\allow 172.20.0.0&#x2F;16 \nallow 172.16.0.0&#x2F;16 \nallow 10.0.0.0&#x2F;8&#39; -i &#x2F;etc&#x2F;chrony.conf</span><br><span class="line"></span><br><span class="line"># 设置开机自启并启动服务</span><br><span class="line">systemctl enable chronyd &amp;&amp; systemctl restart chronyd</span><br></pre></td></tr></table></figure>

<h2 id="ntp客户端"><a href="#ntp客户端" class="headerlink" title="ntp客户端"></a>ntp客户端</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"># 将所有节点设置为中国时区</span><br><span class="line">echo &quot;Asia&#x2F;shanghai&quot; &gt; &#x2F;etc&#x2F;timezone</span><br><span class="line">ln -sf &#x2F;usr&#x2F;share&#x2F;zoneinfo&#x2F;Asia&#x2F;Shanghai &#x2F;etc&#x2F;localtime</span><br><span class="line"></span><br><span class="line"># 安装chrony</span><br><span class="line">yum install chrony -y</span><br><span class="line"></span><br><span class="line"># 其它需要时钟同步的节点，设置从上述服务器同步时钟</span><br><span class="line">sed -i &#39;&#x2F;^server*&#x2F;d&#39; &#x2F;etc&#x2F;chrony.conf</span><br><span class="line">sed -i -e &#39;&#x2F;^# Please consider*&#x2F;a\server 218.204.171.130 minpoll 4 maxpoll 10 iburst&#39; &#x2F;etc&#x2F;chrony.conf</span><br><span class="line">systemctl enable chronyd &amp;&amp; systemctl restart chronyd</span><br><span class="line"></span><br><span class="line"># 非常关键的一步，将时间同步更新到date控件</span><br><span class="line">timedatectl set-ntp yes</span><br><span class="line"></span><br><span class="line"># 同步时间后，把当前时间写入硬件时间</span><br><span class="line">hwclock -w</span><br></pre></td></tr></table></figure></div></article></div></main><footer><div class="paginator"><a class="prev" href="/post/e9025282.html">PREV</a><a class="next" href="/post/2a353e7b.html">NEXT</a></div><div class="copyright"><p>© 2021 PEACE & LOVE</p><p>Powered by <a href="https://hexo.io/" target="_blank">Hexo</a>, <a href="https://github.com/jeremyfan/hexo-theme-still" target="_blank">theme</a> by <a href="https://github.com/jeremyfan" target="_blank">Bill Zong</a>.</p></div></footer></div></body></html>